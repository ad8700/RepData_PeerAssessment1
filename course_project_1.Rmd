---
title: "Course Project 1"
output: html_notebook
author: Andy Domenico
course: Reproducible Research
---

Loading and preprocessing the data

First, import any needed libraries.  

```{r}
echo=TRUE
library(dplyr)
library(ggplot2)
library(data.table)
library(readr)
```
We will need to download the data from the course website.  This should only need
to be done once.  The URL and the date/time of download should be embedded in the
workbook.  The data will be stored in a data directory.  If such a directory does
not exist, the below code will create it.

```{r}
echo=TRUE
if(!dir.exists("./data")) {
  dir.create("./data")
} else {
  print("Data directory already exists")
}
```

Now data can be downloaded and stored in the new data directory

```{r}
echo=TRUE
fileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
dest <- "./data/activity.zip"
download.file(fileUrl, dest)

#unzip the file
unzip(dest, exdir="./data")

print(paste0('Data retrieved from ', fileUrl, ' at ', Sys.time()))

```

The data from the .csv file can now be read into a data frame.  This is raw data
and will be explored.  We expect to transform the data 
```{r}
echo=TRUE
raw_df <- read.csv("./data/activity.csv")
```

The first question to address is: "What is mean total number of steps taken per 
day?"

In order to answer that question, we need to examine the quality of the data.  
Does it contain missing values or extreme outliers?  performing a simple head() 
command reveals that there are indeed NA values.  For purposes of this analysis
removing NA is acceptable.  

Testing for outliers is as simple as looking at a summary and drawing a 
histogram.  Let us start with a summary:

```{r}
echo = TRUE
raw_df <- na.omit(raw_df)
raw_df$date < as.Date(raw_df$date)
summary(raw_df$steps)
```

It seems that there are a lot of 0 values, if the median is 0.  Let's remove 
all rows that have a 0 value for steps and redo the summary.

```{r}
echo=TRUE
rm0_df <- raw_df %>%
  filter(steps != 0)
```

```{r}
echo=TRUE
summary(rm0_df$steps, rm.na=TRUE)
```


We can now draw a histogram using base plotting
```{r}
echo=TRUE
hist(rm0_df$steps, 
     xlab = "Steps",
     main = "Distribution of steps",
     breaks = sqrt(nrow(raw_df)),
     rm.na=TRUE
)
```

The histogram seems to show that most 5 minute intervals have a low number
of steps and few have a high number up towards 800.  Performing 800 steps in 
a single 5 minute interval is probably a strenuous exercise period, but not 
out of the range of possibility and there are data points in the 600-800 range
so these higher values don't appear to be high outliers. 

To calculate the total number of steps taken per day, we can group by day and 
redo the histogram
```{r}
echo=TRUE
daily_df <- rm0_df %>%
  group_by(date) %>%
  summarise(daily_steps = sum(steps))
```

```{r}
echo=TRUE
hist(daily_df$daily_steps,
     xlab="Number of Steps/Day",
     ylab="Count",
     main="Histogram of steps per day")
```
Given this data, the next task is to calculate and report the mean and median of
the total number of steps taken per day

```{r}
echo=TRUE
mean_steps <- mean(daily_df$daily_steps)
med_steps <- median(daily_df$daily_steps)
print(paste0("The mean number of steps per day is ", mean_steps, " and the median number of steps per day is ", med_steps))
```

Now that we have a basic idea of the data, we ask "What is the average daily 
activity pattern?"

To answer this, we will make a time series plot (i.e. \color{red}{\verb|type = "l"|}type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis).  Start by grouping by interval and 
computing the average for each interval

```{r}
echo=TRUE
int_avg_df <- raw_df %>% 
  group_by(interval) %>%
  summarize(AvgSteps=mean(steps))
```

Now to create the plot
```{r}
echo=TRUE
plot(int_avg_df$interval, int_avg_df$AvgSteps,
     type = "l",
     xlab="Interval",
     ylab="Avg steps taken",
     main="Average steps taken per 5 min interval")
```


Now we want know which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

```{r}
echo=TRUE
max_steps <- int_avg_df$interval[which.max(int_avg_df$AvgSteps)]
print(paste0("The interval with the maximum number of steps is ", max_steps))
```

